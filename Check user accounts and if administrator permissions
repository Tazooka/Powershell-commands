$loggedInUsers = quser | Select-String -Pattern 'Active'; $users = Get-WmiObject Win32_UserAccount | Select-Object -ExpandProperty Name; foreach ($user in $users) { $isAdmin = $null; $escapedUser = [regex]::Escape($user); $groupMembers = net localgroup Administrators | Select-String -Pattern $escapedUser; $isLoggedIn = $loggedInUsers -match $user; if ($groupMembers -or $isLoggedIn) { $isAdmin = $true } else { $isAdmin = $false }; Write-Output "$user is Administrator: $isAdmin" }
